{"is_source_file": true, "format": "TypeScript", "description": "This file implements a lightweight publish/subscribe event bus, URL state management functions, toast notifications, and keyboard shortcuts for a note-taking web application.", "external_files": [], "external_methods": ["dispatchEvent", "addEventListener", "removeEventListener", "new URL", "history.pushState", "document.querySelector", "document.createElement", "setTimeout", "navigator.platform", "window.addEventListener", "window.removeEventListener", "document.body", "document.body.appendChild"], "published": ["emit", "subscribe", "currentIdFromURL", "pushIdToURL", "onURLChange", "toast", "registerGlobalShortcuts"], "classes": [], "methods": [{"name": "export function emit(event: BusEvent) { emit", "description": "Dispatches a custom event with the specified BusEvent payload.", "scope": "", "scopeKind": ""}, {"name": "export function subscribe(handler: (e: BusEvent) => void): () => void { subscribe", "description": "Subscribes to BusEvents; returns an unsubscribe function.", "scope": "", "scopeKind": ""}, {"name": "export function currentIdFromURL(): string | null { currentIdFromURL", "description": "Retrieves the current note ID from the URL query parameters.", "scope": "", "scopeKind": ""}, {"name": "export function pushIdToURL(id: string | null) { pushIdToURL", "description": "Updates the URL query parameter 'id' to reflect a new note ID.", "scope": "", "scopeKind": ""}, {"name": "export function onURLChange(handler: (id: string | null) => void): () => void { onURLChange", "description": "Sets up listeners for URL change events and browser navigation, invoking a handler with current or changed note IDs.", "scope": "", "scopeKind": ""}, {"name": "export function toast(message: string, kind: 'info' | 'error' = 'info', timeout = 2200) { toast", "description": "Displays a transient toast message with styling based on 'info' or 'error'.", "scope": "", "scopeKind": ""}, {"name": "export function registerGlobalShortcuts(onSave: () => void, onEscape: () => void) { registerGlobalShortcuts", "description": "Registers keyboard shortcuts for save (Cmd+S / Ctrl+S) and escape, with cleanup function.", "scope": "", "scopeKind": ""}], "calls": ["dispatchEvent", "addEventListener", "removeEventListener", "new URL", "history.pushState", "document.querySelector", "document.createElement", "setTimeout", "navigator.platform", "window.addEventListener", "window.removeEventListener", "t.remove()", "t.style.opacity", "t.style.transform"], "search-terms": ["pub/sub event bus", "URL state management", "toast notifications", "keyboard shortcuts", "note ID URL", "custom event dispatch", "browser history"], "state": 2, "file_id": 10, "knowledge_revision": 21, "git_revision": "", "ctags": [{"_type": "tag", "name": "BUS", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^const BUS = 'bus:event';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "BusEvent", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export type BusEvent =$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "currentIdFromURL", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function currentIdFromURL(): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "emit", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function emit(event: BusEvent) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "f1", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const f1 = (e: Event) => handler((e as CustomEvent).detail.id as string | null);$/", "language": "TypeScript", "kind": "constant", "scope": "onURLChange", "scopeKind": "function"}, {"_type": "tag", "name": "f2", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const f2 = () => handler(currentIdFromURL());$/", "language": "TypeScript", "kind": "constant", "scope": "onURLChange", "scopeKind": "function"}, {"_type": "tag", "name": "handler", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const handler = (e: KeyboardEvent) => {$/", "language": "TypeScript", "kind": "constant", "scope": "registerGlobalShortcuts", "scopeKind": "function"}, {"_type": "tag", "name": "on", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const on = (e: Event) => handler((e as CustomEvent).detail as BusEvent);$/", "language": "TypeScript", "kind": "constant", "scope": "subscribe", "scopeKind": "function"}, {"_type": "tag", "name": "onURLChange", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function onURLChange(handler: (id: string | null) => void): () => void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "pushIdToURL", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function pushIdToURL(id: string | null) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "registerGlobalShortcuts", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function registerGlobalShortcuts(onSave: () => void, onEscape: () => void) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "subscribe", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function subscribe(handler: (e: BusEvent) => void): () => void {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "t", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const t = document.createElement('div');$/", "language": "TypeScript", "kind": "constant", "scope": "toast", "scopeKind": "function"}, {"_type": "tag", "name": "toast", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^export function toast(message: string, kind: 'info' | 'error' = 'info', timeout = 2200) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const url = new URL(location.href);$/", "language": "TypeScript", "kind": "constant", "scope": "currentIdFromURL", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/note-keeper-173366-173375/notes_frontend/src/lib/state.ts", "pattern": "/^  const url = new URL(location.href);$/", "language": "TypeScript", "kind": "constant", "scope": "pushIdToURL", "scopeKind": "function"}], "hash": "91aea9736dc0a7ec744f397d54763f6b", "format-version": 4, "code-base-name": "notes_frontend", "filename": "notes_frontend/src/lib/state.ts", "revision_history": [{"21": ""}]}